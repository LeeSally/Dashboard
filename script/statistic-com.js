//dt
function DatePickerCalendar(e,t,a){this.type=e,this.Parent=t,this.DateVal=a||new Date,this.DateValNew=a||new Date,this.DotList=[];var i=document.createElement("div");StyleUtil.set(i,"display","none"),"month"==this.type||"year"==this.type?i.className="date-calendar date-calendar4x3":"day"!=this.type&&"week"!=this.type||(i.className="date-calendar date-calendar7x6"),this.html=i,DatePickerCalendar.prototype.setPosition=function(){StyleUtil.set(this.html,"display","none"),StyleUtil.set(this.html,"top",this.Parent.html.offsetTop+42+"px");var e=document.body.offsetWidth,t=this.Parent.html.offsetLeft;0<t+305-e?StyleUtil.set(this.html,"left",e-305+"px"):StyleUtil.set(this.html,"left",t+"px")},this.Parent.html.appendChild(this.html);var s=this;if(DatePickerCalendar.prototype.setDate=function(e){this.DateVal=e,this.DateValNew=e},DatePickerCalendar.prototype.preCheckDay=function(e,t,a){var i=DateUtil.getMonthEndDay(new Date(e,t,1));return i.getDate()<a?i.getDate():a},DatePickerCalendar.prototype.refresh=function(e){if(e=e||this.DateVal,StyleUtil.set(this.html,"display","none"),"month"==this.type){this.ToggleBar.innerHTML=DateUtil.format(e,"yyyy");for(var t=0;t<this.DotList.length;t++){var a=this.DotList[t],i=DateUtil.getDate(a.getAttribute("value")),l=this.preCheckDay(e.getFullYear(),t,e.getDate());i.setDate(l),i.setYear(e.getFullYear()),i.setMonth(t),a.setAttribute("value",DateUtil.format(i,"yyyy-mm-dd")),DateUtil.format(i,"yyyymm")==DateUtil.format(this.DateVal,"yyyymm")?ClassUtil.add(a,"date-calendar-choosed"):ClassUtil.remove(a,"date-calendar-choosed"),DateUtil.format(i,"yyyymm")==DateUtil.format(new Date,"yyyymm")?ClassUtil.add(a,"date-calendar-today"):ClassUtil.remove(a,"date-calendar-today")}}else if("day"==this.type||"week"==this.type){this.ToggleBar.innerHTML=DateUtil.format(e,"yyyy mmm");var s=[],n=DateUtil.getWeekStartDay(DateUtil.getMonthStartDay(e));for(t=0;t<42;t++){var d=new Date(n);d.setDate(d.getDate()+t),s.push(d)}for(t=0;t<this.DotList.length;t++){if((a=this.DotList[t]).setAttribute("value",DateUtil.format(s[t],"yyyy-mm-dd")),a.innerHTML=DateUtil.format(s[t],"dd"),s[t]-this.DateVal==0?ClassUtil.add(a,"date-calendar-choosed"):ClassUtil.remove(a,"date-calendar-choosed"),DateUtil.format(s[t],"yyyymmdd")==DateUtil.format(new Date,"yyyymmdd")?ClassUtil.add(a,"date-calendar-today"):ClassUtil.remove(a,"date-calendar-today"),s[t].getMonth()!=this.DateValNew.getMonth()?ClassUtil.add(a,"date-calendar-other"):ClassUtil.remove(a,"date-calendar-other"),"week"==this.type){var r=DateUtil.getWeekStartDay(this.DateValNew),o=DateUtil.getWeekEndDay(this.DateValNew);0<=s[t]-r&&0<=o-s[t]?ClassUtil.add(a,"date-calendar-thisWk"):ClassUtil.remove(a,"date-calendar-thisWk")}}}else if("year"==this.type){var h=DateUtil.get10YearsStart(e);this.ToggleBar.innerHTML=h+" - "+(h+10);for(t=0;t<this.DotList.length;t++){a=this.DotList[t],i=DateUtil.getDate(a.getAttribute("value")),l=this.preCheckDay(h+t,e.getMonth(),e.getDate());i.setDate(l),i.setYear(h+t),i.setMonth(e.getMonth()),a.setAttribute("value",DateUtil.format(i,"yyyy-mm-dd")),a.innerHTML=i.getFullYear(),i.getFullYear()==this.DateVal.getFullYear()?ClassUtil.add(a,"date-calendar-choosed"):ClassUtil.remove(a,"date-calendar-choosed"),i.getFullYear()==(new Date).getFullYear()?ClassUtil.add(a,"date-calendar-today"):ClassUtil.remove(a,"date-calendar-today"),i.getFullYear()<=h||i.getFullYear()>h+10?ClassUtil.add(a,"date-calendar-other"):ClassUtil.remove(a,"date-calendar-other")}}this.setPosition(),StyleUtil.set(this.html,"display","block")},DatePickerCalendar.prototype.show=function(e){e?this.refresh():StyleUtil.set(this.html,"display","none")},DatePickerCalendar.prototype.addTitle=function(e,t){t.className="date-calendar-label";var a=document.createElement("li");a.innerHTML=e,a.className="date-calendar-item",t.appendChild(a)},DatePickerCalendar.prototype.addItem=function(e,t){var a=document.createElement("li");a.className="date-calendar-item",t.appendChild(a);var i=document.createElement("a");i.className="date-calendar-item-a",i.setAttribute("value",DateUtil.format(e,"yyyy-mm-dd")),a.appendChild(i),"month"==this.type?(i.innerHTML=DateUtil.format(e,"mmm"),DateUtil.format(e,"yyyymmm")==DateUtil.format(this.DateVal,"yyyymmm")&&ClassUtil.add(i,"date-calendar-choosed")):"day"==this.type||"week"==this.type?(i.innerHTML=DateUtil.format(e,"dd"),DateUtil.format(e,"yyyymmdd")==DateUtil.format(this.DateVal,"yyyymmdd")&&ClassUtil.add(i,"date-calendar-choosed")):"year"==this.type&&(i.innerHTML=e.getFullYear(),e.getFullYear()==this.DateVal.getFullYear()&&ClassUtil.add(i,"date-calendar-choosed")),this.DotList.push(i)},DatePickerCalendar.prototype.addLine=function(e,t){var a=document.createElement("ul");a.className="date-calendar-row",t.appendChild(a);for(var i=0;i<e.length;i++)this.addItem(DateUtil.getDate(e[i]),a)},"year"==this.type||"month"==this.type||"day"==this.type||"week"==this.type){var l=document.createElement("h3");ClassUtil.add(l,"date-calendar-header"),this.html.appendChild(l);var n=document.createElement("span");n.className="date-picker-button",l.appendChild(n);var d=document.createElement("a");n.appendChild(d),(p=document.createElement("i")).className="date-picker-button-prev",d.appendChild(p),(n=document.createElement("span")).className="date-calendar-header-box",l.appendChild(n);var r=document.createElement("a");if(n.appendChild(r),this.ToggleBar=r,"month"==this.type)r.innerHTML=DateUtil.format(this.DateVal,"yyyy");else if("day"==this.type||"week"==this.type)r.innerHTML=DateUtil.format(this.DateVal,"yyyy mmm");else if("year"==this.type){var o=DateUtil.get10YearsStart(new Date);r.innerHTML=o+" - "+(o+10)}(n=document.createElement("span")).className="date-picker-button",l.appendChild(n),d=document.createElement("a"),(p=document.createElement("i")).className="date-picker-button-next",d.appendChild(p),n.appendChild(d);function h(e,t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0;var a=s.DateValNew.getFullYear(),i=s.DateValNew.getMonth(),l=s.DateValNew.getDate();"month"==s.type?e?a++:a--:"day"==s.type||"week"==s.type?e?i++:0==i?(a--,i=11):i--:"year"==s.type&&(e?a+=10:a-=10),l=s.preCheckDay(a,i,l),s.DateValNew=new Date(a,i,l),s.refresh(s.DateValNew)}EventUtil.add(l,"click",function(e){var t=e||window.event,a=t.srcElement||t.target;"I"==a.nodeName?"date-picker-button-prev"==a.className?h(!1,e):"date-picker-button-next"==a.className&&h(!0,e):"A"==a.nodeName&&("date-picker-button-prev"==a.firstChild.className?h(!1,e):"date-picker-button-next"==a.firstChild.className?h(!0,e):"date-calendar-header-box"==a.parentNode.className&&s.Parent.showUpperCalendar(s.type,s.DateVal,e))});var c=document.createElement("div");ClassUtil.add(c,"date-calendar-body"),this.html.appendChild(c),this.body=c;var y=[];if("month"==this.type){for(var D,p=0;p<12;p++)m=new Date,(D=DateUtil.getMonthEndDay(new Date(m.getFullYear(),p,1))).getDate()<m.getDate()&&m.setDate(D.getDate()),m.setMonth(p),y.push(m);this.addLine(y.slice(0,4),c),this.addLine(y.slice(4,8),c),this.addLine(y.slice(8,12),c)}else if("year"==this.type){for(o=DateUtil.get10YearsStart(new Date),p=0;p<12;p++){var m=new Date,u=s.preCheckDay(o+p,m.getMonth(),m.getDate());m.setDate(u),m.setYear(o+p),y.push(m)}this.addLine(y.slice(0,4),c),this.addLine(y.slice(4,8),c),this.addLine(y.slice(8,12),c)}else if("day"==this.type||"week"==this.type){var C=document.createElement("ul");C.className="date-calendar-row",this.addTitle("Mon",C),this.addTitle("Tue",C),this.addTitle("Wed",C),this.addTitle("Thu",C),this.addTitle("Fri",C),this.addTitle("Sat",C),this.addTitle("Sun",C),this.body.appendChild(C);var g=DateUtil.getWeekStartDay(DateUtil.getMonthStartDay(s.DateVal));for(p=0;p<42;p++){(m=new Date(g)).setDate(m.getDate()+p),y.push(m)}this.addLine(y.slice(0,7),c),this.addLine(y.slice(7,14),c),this.addLine(y.slice(14,21),c),this.addLine(y.slice(21,28),c),this.addLine(y.slice(28,35),c),this.addLine(y.slice(35,42),c)}EventUtil.add(c,"click",function(e){var t=e||window.event,a=t.srcElement||t.target;"A"==a.nodeName&&(s.Parent.closeCalendar(s.type,a.getAttribute("value")),s.show(!1),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)})}EventUtil.add(document,"click",function(e){s.show(!1)},!1),EventUtil.add(window,"resize",function(e){s.setPosition()}),StyleUtil.del(i,"display"),this.show(!1)}function DatePeriodPicker(e,t,a,i,s){var l=document.createElement("div");StyleUtil.set(l,"display","none"),ClassUtil.add(l,"date-picker"),e.appendChild(l),this.html=e,this.style=a||1,this.PeriodType=t.toLowerCase()||"month",this.BaseDate=i||new Date,this.CalendarDay=new DatePickerCalendar("day",this),this.CalendarWk=new DatePickerCalendar("week",this),this.CalendarMth=new DatePickerCalendar("month",this),this.CalendarYr=new DatePickerCalendar("year",this);var n=this;DatePeriodPicker.prototype.setPeriodType=function(e){this.PeriodType=e,this.fillDate(),null!=s&&s(this)},DatePeriodPicker.prototype.changeDate=function(e){this.BaseDate=e,this.fillDate(),null!=s&&s(this)},DatePeriodPicker.prototype.fillDate=function(){if(1==a){var e="";switch(this.PeriodType){case"day":case"week":e=DateUtil.format(this.BaseDate,"yyyy-mm-dd");break;case"month":e=DateUtil.format(this.BaseDate,"yyyy mmm");break;case"year":e=this.BaseDate.getFullYear()}this.StartDayBox.innerHTML=e}else 2==a&&(this.StartDayBox.innerHTML=this.getStartDay(),this.EndDayBox.innerHTML=this.getEndDay())},DatePeriodPicker.prototype.showCalendar=function(e){var t=null;switch(this.PeriodType){case"day":t=this.CalendarDay;break;case"week":t=this.CalendarWk;break;case"month":t=this.CalendarMth;break;case"year":t=this.CalendarYr}t.setDate(this.BaseDate),t.show(e)},DatePeriodPicker.prototype.getStartDay=function(){var e=null;switch(this.PeriodType){case"day":e=this.BaseDate;break;case"week":e=DateUtil.getWeekStartDay(this.BaseDate);break;case"month":e=DateUtil.getMonthStartDay(this.BaseDate);break;case"year":e=this.BaseDate.getFullYear()+"-01-01"}return DateUtil.format(e,"yyyy-mm-dd")},DatePeriodPicker.prototype.getEndDay=function(){var e=null;switch(this.PeriodType){case"day":e=this.BaseDate;break;case"week":e=DateUtil.getWeekEndDay(this.BaseDate);break;case"month":e=DateUtil.getMonthEndDay(this.BaseDate);break;case"year":e=this.BaseDate.getFullYear()+"-12-31"}return DateUtil.format(e,"yyyy-mm-dd")},DatePeriodPicker.prototype.showUpperCalendar=function(e,t,a){"day"==e||"week"==e?(this.CalendarMth.setDate(t),this.CalendarMth.show(!0),"day"==e?this.CalendarDay.show(!1):"week"==e&&this.CalendarWk.show(!1)):"month"==e&&(this.CalendarYr.setDate(t),this.CalendarYr.show(!0),this.CalendarMth.show(!1)),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},DatePeriodPicker.prototype.closeCalendar=function(e,t){if(t=DateUtil.getDate(t),this.PeriodType!=e){var a=null;"month"==e?"day"==this.PeriodType?a=this.CalendarDay:"week"==this.PeriodType&&(a=this.CalendarWk):"year"==e&&(a=this.CalendarMth),a.setDate(t),a.show(!0)}else this.changeDate(t)},DatePeriodPicker.prototype.preCheckDay=function(e,t,a){var i=DateUtil.getMonthEndDay(new Date(e,t,1));return i.getDate()<a?i.getDate():a},(h=document.createElement("span")).className="date-picker-button";var d=document.createElement("a");h.appendChild(d);var r=document.createElement("i");d.appendChild(r),r.className="date-picker-button-prev",l.appendChild(h),EventUtil.add(d,"click",function(){var e=n.BaseDate.getFullYear(),t=n.BaseDate.getMonth(),a=n.BaseDate.getDate(),i=n.PeriodType;if("day"==i)a--;else if("week"==i){if((a-=7)<0)a=DateUtil.getMonthEndDay(new Date(e,t-1,1)).getDate()+a,t--}else"month"==i?0==t?(t=11,e--):t--:"year"==i&&e--;a=n.preCheckDay(e,t,a),n.BaseDate=new Date(e,t,a),n.fillDate(),null!=s&&s(n)});var o=document.createElement("span");ClassUtil.add(o,"date-picker-box"),l.appendChild(o),this.MainBox=o;var h,c=document.createElement("span");ClassUtil.add(c,"date-picker-box-input"),o.appendChild(c),this.StartDayBox=c,2==a&&((c=document.createElement("span")).innerHTML="-",o.appendChild(c),c=document.createElement("span"),ClassUtil.add(c,"date-picker-box-input"),o.appendChild(c),this.EndDayBox=c),EventUtil.add(this.MainBox,"click",function(e){n.showCalendar(!0),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),this.fillDate(),(h=document.createElement("span")).className="date-picker-button";d=document.createElement("a");h.appendChild(d),l.appendChild(h),r=document.createElement("i"),d.appendChild(r),r.className="date-picker-button-next",EventUtil.add(d,"click",function(){var e=n.BaseDate.getFullYear(),t=n.BaseDate.getMonth(),a=n.BaseDate.getDate(),i=n.PeriodType;if("day"==i)++a>DateUtil.getMonthEndDay(new Date(e,t,1)).getDate()&&(a=1,t++);else if("week"==i){a+=7;var l=DateUtil.getMonthEndDay(new Date(e,t,1)).getDate();l<a&&(a-=l,t++)}else"month"==i?t++:"year"==i&&e++;a=n.preCheckDay(e,t,a),n.BaseDate=new Date(e,t,a),n.fillDate(),null!=s&&s(n)}),StyleUtil.del(l,"display")}


//tb
function TabButton(t,e){this.Id=t.id||"",this.Name=t.name||"",this.Event=t.event||null,this.Parent=e;var n=document.createElement("li");n.className="tab-bar-li",n.setAttribute("name",this.Name),e.Wrapper.appendChild(n);var a=document.createElement("a");a.className="tab-bar-a",n.appendChild(a),a.innerHTML=this.Name,this.Html=a,TabButton.prototype.choosed=function(t){t?(ClassUtil.add(this.Html,"tab-bar-choosed"),this.Parent.CurrentVal=this.Name,this.Event&&this.Event(this)):ClassUtil.remove(this.Html,"tab-bar-choosed")}}function TabMenu(t,e){var n=document.getElementById(t),a=document.createElement("ul");n.appendChild(a),ClassUtil.add(a,"tab-bar"),this.Wrapper=a,this.BtnList=[],TabMenu.prototype.size=function(){return this.BtnList.length},TabMenu.prototype.item=function(t){return this.BtnList[t]};for(var i=0;i<e.length;i++){var s=new TabButton(e[i],this);this.BtnList.push(s)}this.BtnList[0].choosed(!0);var r=this;EventUtil.add(a,"click",function(t){var e=t||window.event,n=e.srcElement||e.target,a="";if("LI"==n.nodeName)a=n.getAttribute("name");else if("A"==n.nodeName)a=n.parentNode.getAttribute("name");if(0<a.length)for(var i=0;i<r.BtnList.length;i++){var s=r.BtnList[i];s.choosed(a==s.Name)}})}


//ba
var ChartBarFactory={create:function(t,i,e){if(t.isInit=!1,t.CanvasBack=null,t.CanvasMain=null,t.CtxBack=null,t.CtxMain=null,t.Label=null,t.ChildList=[],t.ActiveBar=null,t.SelectBar=null,t.HTML=i,!t.isInit){i.offsetHeight<240&&i.style.setProperty("height","240px"),i.offsetWidth<240&&i.style.setProperty("width","240px"),t.Width=i.offsetWidth,t.Height=i.offsetHeight;var a=document.createElement("canvas");if(a.setAttribute("style","position:absolute;"),!a.getContext)return!(i.innerHTML='<div style="text-align:center;margin:20px auto;line-height:25px;font-size:12px;">Sorry T T. <br />Your browser not support HTML5</div>');a.height=t.Height,a.width=t.Width,i.appendChild(a),t.CanvasBack=a,t.CtxBack=a.getContext("2d"),(a=document.createElement("canvas")).setAttribute("style","position:absolute;"),a.height=t.Height,a.width=t.Width,i.appendChild(a),t.CanvasMain=a,t.CtxMain=a.getContext("2d"),t.Label="h"==e?new ChartBarLabel(t,"r"):new ChartBarLabel(t),t.isInit=!0}},setSpecialBar:function(t,i,e){var a=null;if("hover"==e)a=t.ActiveBar;else if("click"==e)a=t.SelectBar;i!=a&&("click"==e?(null!=a&&a.reDraw(!1),(t.SelectBar=i)?(i.reDraw(!0),t.Label.move(i)):t.Label.show(!1),t.BarEvent&&t.BarEvent(i)):"hover"==e&&(t.ActiveBar=i,null!=a&&t.SelectBar!=a&&a.reDraw(!1),i?(i.reDraw(!0),t.SelectBar||t.Label.move(i)):t.SelectBar||t.Label.show(!1)))},set:function(t,i){var e,a=t.Width,s=t.Height;(e=t.CtxBack).beginPath(),e.clearRect(0,0,a,s),e.closePath(),(e=t.CtxMain).beginPath(),e.clearRect(0,0,a,s),e.closePath();for(var h=0;h<t.ChildList.length;h++){for(var l=t.ChildList[h],o=0;o<l.BarList.length;o++)l.BarList[o].clear();l.BarList.length=0}if(t.ChildList.length=0,t.ActiveBar=null,t.SelectBar=null,t.Title=i.title||"",t.Style=i.style||"normal",t.LabelSize=i.labelsize||"L",t.BarEvent=i.event||null,t.TopH=60,t.BottomH=30,t.digit=0,t.Label.show(!1),(e=t.CtxBack).font="20px calibri",e.fillStyle="#666",e.textAlign="left",e.textBaseline="middle",e.fillText(t.Title,20,t.TopH/2),t.isNoData=!1,i.data){if(0==i.data.length)t.isNoData=!0;else for(h=0;h<i.data.length;h++)if(!i.data[h].list){t.isNoData=!0;break}}else t.isNoData=!0;t.isNoData&&(e.font="24px arial",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#ccc",e.fillText("No data",t.Width/2,(t.Height-t.BottomH)/2))},getMaxMin:function(t,i,e){for(var a=i.data[0].list[0]||0,s=i.data[0].list[0]||0,h=0;h<i.data.length;h++){var l=i.data[h];if(l.list)for(var o=0;o<l.list.length;o++)l.list[o]>a&&(a=l.list[o]),l.list[o]<s&&(s=l.list[o]),-1<l.list[o].toString().indexOf(".")&&t.digit<l.list[o].toString().split(".")[1].length&&(t.digit=l.list[o].toString().split(".")[1].length)}0==a&&(a=5);var r=0;a-s<.05?r=3:a-s<.5?r=2:a-s<5&&(r=1),r>t.digit&&(t.digit=r),e.max=a,e.min=s},drawLegend:function(t,i){var e=t.CtxMain,a=0,s=0,h=t.Width;e.font="12px arial",e.textAlign="left",e.textBaseline="middle";for(var l=i.data.length-1;0<=l;l--){var o=i.data[l];e.fillStyle="#666",s=e.measureText(o.category||"category"+(l+1)).width,e.fillText(o.category||"category"+(l+1),h-a-(s+30),t.TopH/2);var r=new ChartColorSet(o.color);e.fillStyle=r.getFillColor(1),e.strokeStyle=r.getLineColor(1),e.lineWidth=.5,e.beginPath(),e.rect(h-a-(s+45),t.TopH/2-3,6,6),e.fill(),e.stroke(),e.closePath(),a+=s+50}},addEvent:function(r){EventUtil.add(r.Label.Canvas,"mousemove",EventUtil.throttle(function(t){for(var i=MouseUtil.getEventPosition(t,r.CanvasMain),e=!1,a=null,s=r.YList||r.XList,h=0;h<r.ChildList.length;h++){var l=r.ChildList[h];if(l.BarList){for(var o=0;o<s.length;o++)if(e=l.BarList[o].isMouseIn(i.x,i.y)){a=l.BarList[o];break}if(e)break}}(0<i.x||0<i.y)&&r.setSpecialBar(a,"hover")},120,120),!1),EventUtil.add(r.Label.Canvas,"click",function(t){console.log("click canvas");for(var i=MouseUtil.getEventPosition(t,r.CanvasMain),e=!1,a=null,s=r.YList||r.XList,h=0;h<r.ChildList.length;h++){var l=r.ChildList[h];if(l.BarList){for(var o=0;o<s.length;o++)if(e=l.BarList[o].isMouseIn(i.x,i.y)){a=l.BarList[o];break}if(e)break}}r.setSpecialBar(a,"click")},!1),EventUtil.add(r.Label.Canvas,"mouseleave",function(t){r.SelectBar||r.Label.show(!1,!0)},!1)}};function ChartBarItem(t,i,e,a,s){this.Category=t,this.XName=i,this.YVal=e,this.Left=0,this.Top=0,this.Width=0,this.Height=0,this.CanvasText=null,this.Color=new ChartColorSet,this.Parent=a,this.Context=a.CtxMain,this.isVertical=s||!1,ChartBarItem.prototype.setColor=function(t){this.Color=new ChartColorSet(t)},ChartBarItem.prototype.getFillColor=function(t){return this.Color.getFillColor(t)},ChartBarItem.prototype.getLineColor=function(t){return this.Color.getLineColor(t)},ChartBarItem.prototype.isMouseIn=function(t,i){var e=this.Left,a=this.Top;return this.Parent.XList?t<=e+this.Width&&e<=t&&a-10<=i&&i<=a+this.Height+10:t<=e+this.Width+10&&e-10<=t&&a<=i&&i<=a+this.Height},ChartBarItem.prototype.render=function(t,i,e,a,s){var h=this.Context;h.beginPath(),h.clearRect(t,i,e,a),h.closePath(),"flat"==this.Parent.Style?h.fillStyle=s?this.Color.getFillHighColor(1):this.Color.getFillColor(1):h.fillStyle=s?this.Color.getFillHighColor(.5):this.Color.getFillColor(.5),h.beginPath(),h.rect(t,i,e,a),h.fill(),h.closePath(),"flat"!=this.Parent.Style&&(h.strokeStyle=this.Color.getLineColor(1),h.lineWidth=.5,h.beginPath(),h.moveTo(t+.5,i),h.lineTo(t+e-.5,i),h.moveTo(t+e-.5,i+a),h.lineTo(t+e-.5,i),this.isVertical?(h.moveTo(t+.5,i+a),h.lineTo(t+e-.5,i+a)):(h.moveTo(t+.5,i+a),h.lineTo(t+.5,i)),h.strokeStyle=this.Color.getLineColor(1),h.stroke()),h.closePath()},ChartBarItem.prototype.reDraw=function(t){this.render(this.Left,this.Top,this.Width,this.Height,t)},this.DrawRate=0,ChartBarItem.prototype.speed=8,this.looped=null,ChartBarItem.prototype.draw1Frame=function(t){var i=this.Height,e=this.Top,a=this.Left,s=this.Width;this.isVertical?s=this.Width*t:(i=this.Height*t,e=this.Top+this.Height-i),this.render(a,e,s,i,!1)};var h=this;this.loopAnimation=function(){h.looped=requestAnimationFrame(h.loopAnimation);var t=h.DrawRate,i=h.speed;t<100?(t=100<t+i?100:t+i,h.draw1Frame(t/100),h.DrawRate=t):(window.cancelAnimationFrame(h.looped),h.looped=null)},ChartBarItem.prototype.load=function(){window.requestAnimationFrame?(this.DrawRate=0,this.loopAnimation()):this.render(this.Left,this.Top,this.Width,this.Height,!1)},ChartBarItem.prototype.clear=function(){window.cancelAnimationFrame&&(window.cancelAnimationFrame(this.looped),this.looped=null,this.Context.clearRect(this.Left-2.5,this.Top-1,this.Width+5,this.Height+2),this.Left=0,this.Top=0,this.Width=0,this.Height=0)}}function ChartBarLabel(t,i){this.Width=120,this.Height=63,this.Parent=t,this.OriPoint={left:this.Parent.Width/2,top:this.Parent.Height/2},this.DstPoint={left:this.Parent.Width/2,top:this.Parent.Height/2},this.DstBar=null,this.OriBar=null,this.Dir=i||"u";var e=document.createElement("canvas");e.setAttribute("style","position:absolute;"),e.width=this.Parent.Width,e.height=this.Parent.Height,this.Parent.HTML.appendChild(e),this.Canvas=e,this.Context=e.getContext("2d"),this.isShow=!1;this.Alpha=0,this.speed1=10,this.speed2=15,this.MoveRate=0;var r=this;this.fadeIn=function(){r.loopIn=requestAnimationFrame(r.fadeIn);var t=r.speed1,i=r.speed2,e=r.Alpha,a=r.MoveRate;if(window.cancelAnimationFrame(r.loopOut),100==e&&100==a)return window.cancelAnimationFrame(r.loopIn),r.loopIn=null,void(r.isShow=!0);if(e<100&&(e=100<e+t?100:e+t,r.Canvas.style.opacity=e/100,r.Canvas.style.filter="alpha(opacity="+e/100+")",r.Alpha=e),a<100){var s=r.OriPoint.left,h=r.OriPoint.top,l=r.DstPoint.left-r.OriPoint.left,o=r.DstPoint.top-r.OriPoint.top;a=100<a+i?100:a+i,r.drawBox(s+l*a/100,h+o*a/100),100==(r.MoveRate=a)&&(r.OriBar=r.DstBar,r.OriPoint.left=r.DstPoint.left,r.OriPoint.top=r.DstPoint.top)}},this.fadeOut=function(){r.loopOut=requestAnimationFrame(r.fadeOut);var t=r.speed1,i=r.Alpha;r.loopIn?window.cancelAnimationFrame(r.loopOut):0==i?(window.cancelAnimationFrame(r.loopOut),r.loopOut=null,r.isShow=!1):0<i&&(i=i-t<0?0:i-t,r.Canvas.style.opacity=i/100,r.Canvas.style.filter="alpha(opacity="+i/100+")",r.Alpha=i)},ChartBarLabel.prototype.show=function(t,i){if(window.requestAnimationFrame)if(t)window.cancelAnimationFrame(this.loopOut),this.loopOut=null,this.loopIn&&(window.cancelAnimationFrame(this.loopIn),this.loopIn=null),this.OriBar!=this.DstBar&&(this.MoveRate=0),this.fadeIn();else{if(i)window.cancelAnimationFrame(this.loopIn),this.loopIn=null,window.cancelAnimationFrame(this.loopOut),this.loopOut=null;else if(this.loopIn||this.loopOut)return;this.fadeOut()}else t?this.Canvas.style.setProperty("display","block"):this.Canvas.style.setProperty("display","none")},ChartBarLabel.prototype.drawBox=function(t,i){var e=this.Context,a=this.Height,s=this.Width;e.clearRect(0,0,this.Parent.Width,this.Parent.Height);var h=this.DstBar;e.beginPath(),BrowserUtil.isIE()?e.fillStyle="RGB(0,0,0)":e.fillStyle="RGB(0,0,0,0.6)","r"==this.Dir?(e.moveTo(t-5,i+a/2),e.lineTo(t,i+a/2-5),e.lineTo(t,i+5),e.arc(t+5,i+5,5,Math.PI,3*Math.PI/2,!1),e.lineTo(t+s,i),e.arc(t+s-5,i+5,5,-Math.PI/2,0,!1),e.lineTo(t+s,i+a-5),e.arc(t+s-5,i+a-5,5,0,Math.PI/2,!1),e.lineTo(t,i+a),e.arc(t+5,i+a-5,5,Math.PI/2,Math.PI,!1),e.lineTo(t,i+a/2+5),e.lineTo(t-5,i+a/2)):(e.moveTo(t+s/2,i+a+5),e.lineTo(t+s/2-5,i+a),e.lineTo(t+5,i+a),e.arc(t+5,i+a-5,5,Math.PI/2,Math.PI,!1),e.lineTo(t,i+5),e.arc(t+5,i+5,5,Math.PI,Math.PI/2*3,!1),e.lineTo(t+5,i),e.arc(t+s-5,i+5,5,Math.PI/-2,0,!1),e.lineTo(t+s,i+a-5),e.arc(t+s-5,i+a-5,5,0,Math.PI/2,!1),e.lineTo(t+s/2+5,i+a),e.lineTo(t+s/2,i+a+5)),e.fill(),e.closePath(),e.beginPath(),e.fillStyle=h.getFillColor(1),e.rect(t+10,i+10,8,8),e.fill(),e.lineWidth=.5,e.strokeStyle=h.getLineColor(1),e.stroke(),e.closePath(),e.beginPath(),e.fillStyle="rgb(255,255,255)",e.textAlign="left",e.textBaseline="top","S"!=this.Parent.LabelSize?(e.font="bold 12px arial",e.fillText(h.Category,t+25,i+8),e.font="normal 12px arial",e.fillText(h.XName,t+25,i+25),e.fillText(h.YVal,t+25,i+42)):(e.font="normal 12px arial",e.fillText(h.YVal,t+25,i+6)),e.closePath()},ChartBarLabel.prototype.move=function(t){if(t){var i=this.Context;if(this.Width=40+i.measureText(t.YVal).width,i.font="normal 12px arial","S"==this.Parent.LabelSize)this.Height=25;else{var e=40+i.measureText(t.XName).width;this.Width<e&&(this.Width=e),i.font="bold 12px arial";var a=40+i.measureText(t.Category).width;this.Width<a&&(this.Width=a)}"r"==this.Dir?(this.DstPoint.left=t.Left+t.Width+10,this.DstPoint.top=t.Top-(this.Height-t.Height)/2):(this.DstPoint.left=t.Left+(t.Width-this.Width)/2,this.DstPoint.top=t.Top-this.Height-8),this.DstBar=t,this.show(!0)}else this.show(!1)}}function ChartBar(t){ChartBarFactory.create(this,t),ChartBar.prototype.setSpecialBar=function(t,i){ChartBarFactory.setSpecialBar(this,t,i)},ChartBar.prototype.draw=function(t){if(!this.isInit)return!1;ChartBarFactory.set(this,t),this.xLabels=t.xLabels,this.xNames=t.xNames,this.XList=this.xNames||this.xLabels||[],this.Y=t.y||{},this.SpaceH=25;var i=this.Width,e=this.Height,a=this.CtxBack;if(!this.isNoData){ChartBarFactory.getMaxMin(this,t,this.Y),this.Y.min=this.Y.min-this.SpaceH*(this.Y.max-this.Y.min)/(e-this.BottomH-this.TopH),this.Y.min<0&&(this.Y.min=0),this.Y.max=this.Y.max+this.SpaceH*(this.Y.max-this.Y.min)/(e-this.BottomH-this.TopH),this.Y.min=Number(this.Y.min.toFixed(this.digit));var s=(e-this.BottomH-this.TopH)/(this.Y.max-this.Y.min),h=this.SpaceH/s;h=h.toFixed(this.digit);var l=(this.Y.max-this.Y.min)/h;a.font="11px arial",a.textAlign="left",a.textBaseline="bottom";for(var o=1;o<l;o++){var r=this.Y.min+h*o;r<=this.Y.max&&e-this.BottomH-h*o*s>this.TopH&&(a.fillStyle="rgb(200,200,200)",a.fillRect(20,e-this.BottomH-h*o*s,i-40,.5),a.fillStyle="#999",a.fillText(NumUtil.trimBigNum(r,this.digit),20,e-this.BottomH-(r-this.Y.min)*s))}a.beginPath(),a.moveTo(20,e-this.BottomH),a.lineTo(i-20,e-this.BottomH),a.lineWidth=.5,a.strokeStyle="rgb(120,120,120)",a.stroke(),a.fillText(NumUtil.trimBigNum(this.Y.min,this.digit),20,e-this.BottomH-3),a.closePath(),a.font="bold 11px arial",a.fillStyle="#666",a.textAlign="center",a.textBaseline="top";var n=(i-60)/(this.XList.length+1);for(o=0;o<this.XList.length;o++)a.fillText(this.XList[o].Label||this.XList[o],n*(o+1)+40,e-this.BottomH+5);ChartBarFactory.drawLegend(this,t);for(o=0;o<t.data.length;o++){var d=t.data[o];if(d.list){d.BarList=[];for(var c=0;c<this.XList.length&&d.list&&!(c>=d.list.length);c++){var f=new ChartBarItem(d.category||"category"+(o+1),this.XList[c].LongName||this.XList[c],d.list[c],this);f.Width=n/(2*t.data.length),f.Left=n*(c+1)-f.Width*t.data.length/2+o*f.Width+40,f.Height=(f.YVal-this.Y.min)*s,f.Top=e-this.BottomH-f.Height,f.setColor(d.color),f.load(),d.BarList[c]=f,this.ChildList.push(d)}}}this.Label.show(!1),ChartBarFactory.addEvent(this)}}}function ChartBarVertical(t){ChartBarFactory.create(this,t,"h"),ChartBarVertical.prototype.setSpecialBar=function(t,i){ChartBarFactory.setSpecialBar(this,t,i)},ChartBarVertical.prototype.draw=function(t){if(!this.isInit)return!1;ChartBarFactory.set(this,t),this.LabelSize=t.labelsize||"S";var i=this.Width,e=this.Height,a=this.CtxBack;if(this.yLabels=t.yLabels,this.yNames=t.yNames,this.YList=this.yNames||this.yLabels||[],this.X=t.x||{},this.SpaceH=45,!this.isNoData){ChartBarFactory.getMaxMin(this,t,this.X),this.Left=30,this.X.min=this.X.min-(this.X.max-this.X.min)/((i-this.Left-20)/this.SpaceH),this.X.min<0&&(this.X.min=0),this.X.max=this.X.max+(this.X.max-this.X.min)/((i-this.Left-20)/this.SpaceH)*3,this.X.min=Number(this.X.min.toFixed(this.digit)),a.font="normal 11px arial";for(var s=(e-this.TopH-this.BottomH)/(this.YList.length+1),h=0;h<this.YList.length;h++){var l=a.measureText(this.YList[h].Label||this.YList[h]).width;this.Left<l&&(this.Left=l)}if(this.Left+=30,t.sort&&1==t.data.length&&"desc"==t.sort){var o=t.data[0];for(h=0;h<o.list.length;h++)for(var r=h+1;r<o.list.length;r++)if(o.list[h]<o.list[r]){var n=o.list[r];o.list[r]=o.list[h],o.list[h]=n;var d=this.YList[h].Label||this.YList[h],c=this.YList[r].Label||this.YList[r];this.YList[h].Label?(this.YList[r].Label=d,this.YList[h].Label=c):(this.YList[r]=d,this.YList[h]=c)}}a.beginPath(),a.textBaseline="middle",a.moveTo(this.Left,this.TopH),a.lineTo(this.Left,e-this.BottomH),a.lineWidth=.5,a.font="normal 11px arial",a.strokeStyle="rgb(150,150,150)",a.stroke(),a.textAlign="right",a.fillText(NumUtil.trimBigNum(this.X.min,this.digit),this.Left,e-this.BottomH/2),a.closePath(),a.fillStyle="#666",a.textAlign="right",a.textBaseline="middle",a.font="bold 11px arial";for(h=0;h<this.YList.length;h++)a.beginPath(),a.fillText(this.YList[h].Label||this.YList[h],this.Left-10,this.TopH+s*(h+1)),a.closePath();var f=(i-this.Left-20)/(this.X.max-this.X.min),m=this.SpaceH/f;m=m.toFixed(this.digit);var p=(this.X.max-this.X.min)/m;a.font="11px arial",a.textAlign="center",a.textBaseline="middle";for(h=1;h<p;h++){var g=this.X.min+m*h;g<=this.X.max&&this.Left+(g-this.X.min)*f<i-20&&(a.fillStyle="rgb(200,200,200)",a.fillRect(this.Left+(g-this.X.min)*f,this.TopH,.5,e-this.TopH-this.BottomH),a.fillStyle="#999",a.fillText(NumUtil.trimBigNum(g,this.digit),this.Left+(g-this.X.min)*f,e-this.BottomH/2))}ChartBarFactory.drawLegend(this,t);for(h=0;h<t.data.length;h++){if((n=t.data[h]).list){n.BarList=[];for(r=0;r<this.YList.length;r++){var L=new ChartBarItem(n.category||"category"+(h+1),this.YList[r].LongName||this.YList[r],n.list[r],this,!0);L.Width=Math.round((i-this.Left-20)*(L.YVal-this.X.min)/(this.X.max-this.X.min)),L.Left=this.Left,L.Height=s/(2*t.data.length),L.Top=this.TopH+(s*(r+1)-L.Height*t.data.length/2+h*L.Height),L.setColor(n.color),L.load(),n.BarList[r]=L,this.ChildList.push(n)}}}this.Label.show(!1),ChartBarFactory.addEvent(this)}}}


//pi
function ChartPieItem(t,e,i,a,n){this.No=t.num||0,this.Name=t.name||"Pie "+(this.No+1),this.Value=t.value||0,this.Rate=t.rate||0,this.Color=t.ColorSet||new ChartColorSet(t.color),this.Parent=i,this.isDrawNum=n||!1,this.AngleS=e||0,this.AngleE=this.AngleS+2*this.Rate*Math.PI,a&&(this.Legend=new LegendItem(this)),ChartPieItem.prototype.getFillColor=function(t){return this.Color.getFillColor(t)},ChartPieItem.prototype.getLineColor=function(t){return this.Color.getLineColor(t)},ChartPieItem.prototype.getFillHighColor=function(t){return this.Color.getFillHighColor(t)},ChartPieItem.prototype.render=function(t,e){var i=this.Parent.ContextBody;i.lineWidth=1,t=t||2*this.Rate*Math.PI;var a=this.Parent.Radius,n=this.Parent.CenterX,h=this.Parent.CenterY,l=this.Parent.LineWidth,o=this.AngleS+t;i.beginPath(),this.Parent.isPie?(i.lineTo(n,h),i.lineTo(n+Math.cos(this.AngleS)*a,h+Math.sin(this.AngleS)*a),i.arc(n,h,a,this.AngleS,o,!1),i.lineTo(n+Math.cos(o)*a,h+Math.sin(o)*a),i.lineTo(n,h)):(i.lineTo(n+Math.cos(this.AngleS)*(a+l),h+Math.sin(this.AngleS)*(a+l)),i.arc(n,h,a+l,this.AngleS,o,!1),i.lineTo(n+Math.cos(o)*a,h+Math.sin(o)*a),i.arc(n,h,a,o,this.AngleS,!0),i.lineTo(n+Math.cos(this.AngleS)*(a+l),h+Math.sin(this.AngleS)*(a+l))),i.strokeStyle=this.getLineColor(1),"flat"==this.Parent.Style?i.fillStyle=e?this.getFillHighColor(1):this.getFillColor(1):(i.fillStyle=this.getLineColor(1),i.stroke(),i.fillStyle=e?this.getFillHighColor(.6):this.getFillColor(.6)),i.fill(),i.closePath(),this.isDrawNum&&(i.font=11+(a-25)/5*2+"px Tahoma",i.fillStyle=this.getLineColor(1),i.textAlign="center",i.textBaseline="middle",i.fillText((t/(2*Math.PI)*100).toFixed(2)+" %",n,h,.95*a*2))},ChartPieItem.prototype.reDraw=function(t,e){this.render(2*this.Rate*Math.PI,t),this.Legend&&this.Legend.render(t,e)},ChartPieItem.prototype.isEnterIn=function(t,e){var i=t-this.Parent.CenterX,a=e-this.Parent.CenterY,n=this.Parent.Radius,h=this.Parent.LineWidth,l=Math.atan(a/i);i<0&&(l+=Math.PI);var o=!1;return this.Parent.isPie?Math.pow(i,2)+Math.pow(a,2)<=Math.pow(n+8,2)&&l>=this.AngleS&&l<=this.AngleE&&(o=!0):Math.pow(i,2)+Math.pow(a,2)<=Math.pow(n+h+8,2)&&Math.pow(i,2)+Math.pow(a,2)>=Math.pow(n-8,2)&&l>=this.AngleS&&l<=this.AngleE&&(o=!0),this.Legend&&this.Legend.isEnter(t,e)&&(o=!0),o}}function LegendItem(t){this.PieItem=t,this.Parent=t.Parent,this.isInit=!1,this.Width=100,this.Height=30,this.Left=this.Parent.Width-140,this.Top=this.Parent.TopH+25+this.PieItem.No*this.Height,LegendItem.prototype.render=function(t){var e=this.Parent.ContextFont,i=this.Top,a=this.Height,n=this.Width,h=this.Left;if(e.clearRect(h-20,i-a/2,n+25,a),this.Parent.SelectedItem==this.PieItem){e.fillStyle="#999",e.font="bold 12px arial";var l=e.measureText(this.PieItem.Name||"category"+this.PieItem.No).width;e.fillRect(h,i+10,l,.5)}e.font="12px arial",e.fillStyle="#666",t&&(e.fillStyle="#333",e.font="bold 12px arial"),e.textAlign="left",e.textBaseline="middle",e.fillText(this.PieItem.Name||"category"+this.PieItem.No,h,i,n),this.Width=e.measureText(this.PieItem.Name||"category"+this.PieItem.No).width+5,e.fillStyle=this.PieItem.Color.getFillColor(1),e.strokeStyle=this.PieItem.Color.getLineColor(1),e.lineWidth=.5,e.beginPath(),e.rect(h-15,i-4,6,6),e.fill(),e.stroke(),e.closePath()},this.isInit||this.render(),LegendItem.prototype.isEnter=function(t,e){var i=this.Top,a=this.Height,n=this.Width,h=this.Left;return h-20<t&&t<h+n&&i-a/2<e&&e<i+a/2}}function PieLabel(t){this.Parent=t,this.Width=100,this.Height=45,this.TriSize=5,this.OriPoint={left:this.Parent.Width/2,top:this.Parent.Height/2},this.DstPoint={left:this.Parent.Width/2,top:this.Parent.Height/2},this.OriPie=null,this.DstPie=null;var e=document.createElement("canvas");e.setAttribute("style","position:absolute;"),e.width=this.Parent.Width,e.height=this.Parent.Height,this.Parent.HTML.appendChild(e),this.Canvas=e,this.Context=e.getContext("2d"),this.isShow=!1,this.Alpha=0,this.MoveRate=0,this.speed1=10,this.speed2=15;var s=this;this.fadeIn=function(){s.loopIn=requestAnimationFrame(s.fadeIn);var t=s.speed1,e=s.speed2,i=s.Alpha,a=s.MoveRate;if(100==i&&100==a)return window.cancelAnimationFrame(s.loopIn),s.loopIn=null,void(s.isShow=!0);if(i<100&&(i=100<i+t?100:i+t,s.Canvas.style.opacity=i/100,s.Canvas.style.filter="alpha(opacity="+i/100+")",s.Alpha=i),a<100){var n=s.OriPoint.left,h=s.OriPoint.top,l=s.DstPoint.left-s.OriPoint.left,o=s.DstPoint.top-s.OriPoint.top;a=100<a+e?100:a+e,s.drawBox(n+l*a/100,h+o*a/100),100==(s.MoveRate=a)&&(s.OriPie=s.DstPie,s.OriPoint.left=s.DstPoint.left,s.OriPoint.top=s.DstPoint.top)}},this.fadeOut=function(){s.loopOut=requestAnimationFrame(s.fadeOut);var t=s.speed1,e=s.Alpha;0==e?(window.cancelAnimationFrame(s.loopOut),s.loopOut=null,s.isShow=!1):0<e&&(e=e-t<0?0:e-t,s.Canvas.style.opacity=e/100,s.Canvas.style.filter="alpha(opacity="+e/100+")",s.Alpha=e)},PieLabel.prototype.show=function(t,e){if(window.requestAnimationFrame)if(t)window.cancelAnimationFrame(this.loopOut),this.loopOut=null,this.loopIn&&(window.cancelAnimationFrame(this.loopIn),this.loopIn=null),this.OriPie!=this.DstPie&&(this.MoveRate=0),this.fadeIn();else{if(e)window.cancelAnimationFrame(this.loopIn),this.loopIn=null,window.cancelAnimationFrame(this.loopOut),this.loopOut=null;else if(this.loopIn||this.loopOut)return;this.fadeOut()}else t?this.Canvas.style.setProperty("display","block"):this.Canvas.style.setProperty("display","none")},this.drawBox=function(t,e){var i=this.Context,a=this.TriSize,n=this.Height,h=this.Width,l=this.DstPie;i.clearRect(0,0,this.Parent.Width,this.Parent.Height),i.beginPath(),BrowserUtil.isIE()?i.fillStyle="RGB(0,0,0)":i.fillStyle="RGB(0,0,0,0.6)",Math.cos((l.AngleS+l.AngleE)/2)<0||1==Math.abs(Math.sin((l.AngleS+l.AngleE)/2))?(i.moveTo(t-a,e+n/2),i.lineTo(t,e+(n/2-a)),i.lineTo(t,e+5),i.arc(t+5,e+5,5,Math.PI,3*Math.PI/2,!1),i.lineTo(t+h-5,e),i.arc(t+h-5,e+5,5,Math.PI/-2,0,!1),i.lineTo(t+h,e+n-5),i.arc(t+h-5,e+n-5,5,0,Math.PI/2,!1),i.lineTo(t,e+n),i.arc(t+5,e+n-5,5,Math.PI/2,Math.PI,!1),i.lineTo(t,e+(n/2+a))):(i.moveTo(t+5,e),i.lineTo(t+h-5,e),i.arc(t+h-5,e+5,5,Math.PI/-2,0,!1),i.lineTo(t+h,e+n/2-a),i.lineTo(t+h+a,e+n/2),i.lineTo(t+h,e+n/2+a),i.lineTo(t+h,e+n-5),i.arc(t+h-5,e+n-5,5,0,Math.PI/2,!1),i.lineTo(t+5,e+n),i.arc(t+5,e+n-5,5,Math.PI/2,Math.PI,!1),i.lineTo(t,e-5),i.arc(t+5,e+5,5,Math.PI,3*Math.PI/2,!1)),i.fill(),i.closePath(),i.beginPath(),i.fillStyle=l.getFillColor(1),i.rect(t+10,e+10,8,8),i.fill(),i.lineWidth=.5,i.strokeStyle=l.getLineColor(1),i.stroke(),i.closePath(),i.beginPath(),i.fillStyle="rgb(255,255,255)",i.font="normal 12px arial",i.textAlign="left",i.textBaseline="top","S"!=this.Parent.LabelSize?(i.fillText(l.Value.toFixed(1)+" , "+(100*l.Rate).toFixed(2)+"%",t+25,e+25),i.font="bold 12px arial",i.fillText(l.Name,t+25,e+8)):(i.fillText(l.Value.toFixed(1),t+25,e+8),i.fillText((100*l.Rate).toFixed(2)+"%",t+25,e+25)),i.closePath()},PieLabel.prototype.move=function(t){if(t){"S"==this.Parent.LabelSize&&(this.Height=45);var e=this.Parent.CenterY+(this.Parent.Radius+this.Parent.LineWidth/2)*Math.sin((t.AngleS+t.AngleE)/2)-this.Height/2,i=this.Parent.CenterX+(this.Parent.Radius+this.Parent.LineWidth/2)*Math.cos((t.AngleS+t.AngleE)/2),a=this.Context;if("S"!=this.Parent.LabelSize){a.font="bold 12px arial",this.Width=40+a.measureText(t.Name).width,a.font="normal 12px arial";var n=40+a.measureText(t.Value.toFixed(1)+" , "+(100*t.Rate).toFixed(2)+"%").width;this.Width<n&&(this.Width=n)}else{a.font="normal 12px arial",this.Width=40+a.measureText(t.Value.toFixed(1)).width;n=40+a.measureText((100*t.Rate).toFixed(2)+"%").width;this.Width<n&&(this.Width=n)}Math.cos((t.AngleS+t.AngleE)/2)<0||1==Math.abs(Math.sin((t.AngleS+t.AngleE)/2))?i+=this.TriSize:i=i-this.Width-this.TriSize,this.DstPoint.left=i,this.DstPoint.top=e,this.DstPie=t,this.show(!0)}else this.show(!1)}}var ChartPieFactory={create:function(t,e){t.HTML=e,t.isInit=!1,e.offsetHeight<100&&e.style.setProperty("height","100px"),e.offsetWidth<100&&e.style.setProperty("width","100px"),t.Width=e.offsetWidth,t.Height=e.offsetHeight;var i=document.createElement("canvas");if(!i.getContext)return!(e.innerHTML='<div style="text-align:center;margin:20px auto;line-height:25px;font-size:12px;">Sorry T T. <br />Your browser not support HTML5</div>');i.setAttribute("style","position:absolute;"),i.height=t.Height,i.width=t.Width,e.appendChild(i),t.CanvasBody=i,t.ContextBody=i.getContext("2d"),i=document.createElement("canvas"),e.appendChild(i),i.setAttribute("style","position:absolute;"),i.height=t.Height,i.width=t.Width,t.CanvasFont=i,t.ContextFont=i.getContext("2d"),t.Label=new PieLabel(t),t.ChildList=[],t.ActivePie=null,t.SelectedItem=null,t.isInit=!0},draw1Frame:function(t,e){if(0!=e&&0!=t.Sum){var i=2*e*Math.PI-Math.PI/2;t.ContextBody.clearRect(0,0,t.Width,t.Height);for(var a=0;a<t.ChildList.length;a++){var n=t.ChildList[a];if(n.AngleS>i)break;n.AngleE<=i?n.render(n.AngleE-n.AngleS,!1):n.render(i-n.AngleS,!1)}}},setSpecialPie:function(t,e,i){var a=null,n=t.ContextBody;if(0!=t.Sum)if("hover"==i?a=t.ActivePie:"click"==i&&(a=t.SelectedItem),e!=a){n.beginPath(),n.clearRect(0,0,t.Width,t.Height),n.closePath(),"hover"==i?t.ActivePie=e:"click"==i&&(t.SelectedItem=e);for(var h=0;h<t.ChildList.length;h++){var l=t.ChildList[h];l==e||l==t.SelectedItem?l.reDraw(!0):l.reDraw(!1)}if("click"==i){t.Label.move(e);var o=t.PieEvent;null!=o&&null!=o&&o(e)}else t.SelectedItem||t.Label.move(e)}else e||("click"==i?t.Label.show(!1):t.SelectedItem||t.Label.show(!1))},set:function(t,e){if(!t.isInit)return!1;var i=t.ContextBody;i.beginPath(),i.clearRect(0,0,t.Width,t.Height),i.closePath(),(i=t.ContextFont).beginPath(),i.clearRect(0,0,t.Width,t.Height),i.closePath(),t.Label.show(!1),t.isPie=e.isPie||!1,t.LineWidth=e.linewidth||15,t.Title=e.title||null,t.Radius=e.radius||60,t.LabelSize=e.labelsize||"L",t.Style=e.style||"normal",t.PieEvent=e.event||null,null!=t.Title?t.TopH=55:t.TopH=0},adjustData:function(t){t.Radius+10>t.CenterX&&(t.CenterX=t.Radius+10),t.Radius+t.TopH+10>t.CenterY&&(t.CenterY=t.Radius+t.TopH+10),t.Radius<25&&(t.Radius=25)},drawTitle:function(t,e,i){if(t.Title&&((a=t.ContextFont).beginPath(),a.clearRect(0,0,t.Width,t.Height),a.closePath(),a.font="20px calibri",a.fillStyle="#666",a.textAlign=e||"center",a.textBaseline="middle",a.fillText(t.Title,i||25,t.TopH/2)),0==t.Sum){var a=t.ContextFont;a.beginPath(),a.fillStyle="rgb(180,180,180)",a.font="normal 32px calibri",a.textAlign="center",a.textBaseline="middle",a.fillText("No Data",t.CenterX,t.CenterY),a.closePath()}},addEvent:function(h){EventUtil.add(h.Label.Canvas,"mousemove",EventUtil.throttle(function(t){for(var e=MouseUtil.getEventPosition(t,h.CanvasBody),i=null,a=0;a<h.ChildList.length;a++){var n=h.ChildList[a];if(n&&n.isEnterIn(e.x,e.y)){i=n;break}}(0<e.x||0<e.y)&&h.setSpecialPie(i,"hover")},120,100),!1),EventUtil.add(h.Label.Canvas,"click",function(t){for(var e=MouseUtil.getEventPosition(t,h.CanvasBody),i=null,a=0;a<h.ChildList.length;a++){var n=h.ChildList[a];if(n&&n.isEnterIn(e.x,e.y)){i=n;break}}h.setSpecialPie(i,"click")})}};function ChartPie(t){ChartPieFactory.create(this,t),this.AnimateRate=0,this.speed=5;var i=this;this.loopAnimation=function(){i.looped=requestAnimationFrame(i.loopAnimation);var t=i.speed,e=i.AnimateRate;e<100?(e=100<e+t?100:e+t,ChartPieFactory.draw1Frame(i,e/100),i.AnimateRate=e):(window.cancelAnimationFrame(i.looped),i.looped=null)},ChartPie.prototype.setSpecialPie=function(t,e){ChartPieFactory.setSpecialPie(this,t,e)},ChartPie.prototype.render=function(t){if(!this.isInit)return!1;if(ChartPieFactory.set(this,t),this.CenterX=t.X||this.Radius+35,this.CenterY=t.Y||this.Height/2+this.TopH/2||this.Radius+this.TopH+this.LineWidth,ChartPieFactory.adjustData(this),this.Sum=0,t.list){for(var e=0;e<t.list.length;e++)this.Sum+=t.list[e].value;for(e=0;e<t.list.length;e++)for(var i=e+1;i<t.list.length;i++)if(t.list[e].value<t.list[i].value){var a=t.list[i];t.list[i]=t.list[e],t.list[e]=a}for(e=0;e<t.list.length;e++){a=t.list[e];0<this.Sum?a.rate=a.value/this.Sum:a.rate=0}}ChartPieFactory.drawTitle(this,"left");var n=0,h=-Math.PI/2;if(this.ChildList.length=0,t.list){for(e=0;e<t.list.length;e++){a=t.list[e];var l=new ChartColorSet("blue");null!=t.color?(l=new ChartColorSet(t.color,e+1),t.list.ColorSet=l):l=new ChartColorSet(a.color),a.ColorSet=l,a.num=e;var o=new ChartPieItem(a,h,this,!0);this.ChildList.push(o),0!=this.Sum&&(n+=o.Value,h=-Math.PI/2+n/this.Sum*2*Math.PI,window.requestAnimationFrame||o.render())}window.requestAnimationFrame&&(this.AnimateRate=0,this.loopAnimation()),ChartPieFactory.addEvent(this)}}}function ChartPercentPie(t){ChartPieFactory.create(this,t),this.AnimateRate=0,this.speed=5;var i=this;this.loopAnimation=function(){i.looped=requestAnimationFrame(i.loopAnimation);var t=i.speed,e=i.AnimateRate;e<100?(e=100<e+t?100:e+t,ChartPieFactory.draw1Frame(i,e/100),i.AnimateRate=e):(window.cancelAnimationFrame(i.looped),i.looped=null)},ChartPercentPie.prototype.setSpecialPie=function(t,e){ChartPieFactory.setSpecialPie(this,t,e)},ChartPercentPie.prototype.render=function(t){if(!this.isInit)return!1;t.labelsize=t.labelsize||"S",ChartPieFactory.set(this,t),this.Name=t.name||"",this.Sum=t.sum||0,this.Val=t.value||0,this.Color=t.color||"blue",this.CenterX=t.X||this.Width/2||this.Radius+25,this.CenterY=t.Y||(this.Height-this.TopH)/2+this.TopH||this.Radius+this.TopH+this.LineWidth,ChartPieFactory.adjustData(this),this.Sum>=this.Val?this.Rate=this.Val/this.Sum:(this.Rate=1,this.Val=this.Sum),ChartPieFactory.drawTitle(this,"center",this.Width/2),this.ChildList.length=0;var e={name:this.Name,value:this.Val,rate:this.Rate,color:this.Color},i=new ChartPieItem(e,-Math.PI/2,this,!1,!0);this.ChildList.push(i),window.requestAnimationFrame||i.render(),i=new ChartPieItem(e={name:"Other",value:this.Sum-this.Val,rate:1-this.Rate,color:"gray"},-Math.PI/2+this.Val/this.Sum*2*Math.PI,this,!1),this.ChildList.push(i),window.requestAnimationFrame||i.render(),window.requestAnimationFrame&&(this.AnimateRate=0,this.loopAnimation()),ChartPieFactory.addEvent(this)}}


//load
function LoadingCircle(t,i,s,a){this.canvas=document.createElement("canvas"),s=s||t.offsetWidth,a=a||t.offsetHeight,this.canvas.setAttribute("width",s+"px"),this.canvas.setAttribute("height",a+"px"),this.canvas.setAttribute("style","position:absolute;"),this.canvas.getContext&&(this.ctx=this.canvas.getContext("2d")),t.appendChild(this.canvas),this.parentEle=t,this.centerX=s/2,this.centerY=a/2,this.color=i||"rgba(200,200,200,0.8)",this.isRun=!1,LoadingCircle.prototype.draw=function(t,i){if(this.ctx){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var s=0;s<9;s++){var a=2*Math.PI*(s+1)/9;this.ctx.beginPath(),this.ctx.arc(this.centerX+Math.sin(i+a)*t,this.centerY-Math.cos(i+a)*t,.8+.3*s,0,2*Math.PI),this.ctx.fillStyle=this.color,this.ctx.fill()}}},LoadingCircle.prototype.start=function(){if(this.ctx){window.clearInterval(this.loop);var t=0,i=5;this.isRun=!0;var s=this;this.loop=window.setInterval(function(){0<=t&&t<=4*Math.PI/5?i+=.4:5<i&&(i-=.4),t+=i/5*Math.PI/36,t%=2*Math.PI,s.draw(15,t)},30)}},LoadingCircle.prototype.stop=function(){this.ctx&&(window.clearInterval(this.loop),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.isRun=!1)},LoadingCircle.prototype.hide=function(){this.canvas.style.cssText="display:none"},LoadingCircle.prototype.show=function(){this.canvas.style.cssText="display:block"}}


//pg
function Pagination(e,a){this.Wrapper=e,this.PerPageList=a.PerPageList||[20,50,100],this.PerPage=a.PerPage||20,this.MaxPage=a.MaxPage||1,this.CurPage=1,this.TurnPageEvent=a.TurnPageEvent||null,this.SetMaxPageEvent=a.MaxPageEvent||null,e.style.cssText="display:none;",e.className="pagination";var t=document.createElement("ul");t.className="pagination-select",e.appendChild(t),this.PageSelect=t;var n=document.createElement("div");n.className="pagination-info",e.appendChild(n),this.PageInfo=n;var i=document.createElement("span");i.className="pagination-info-inputbox",i.innerHTML="Go to";var s=document.createElement("input");s.setAttribute("type","text"),i.appendChild(s),n.appendChild(i),this.PageJumpInput=s,(i=document.createElement("span")).className="pagination-info-space",n.appendChild(i);var l=document.createElement("i");i.appendChild(l),(i=document.createElement("span")).className="pagination-info-size",n.appendChild(i),(n=document.createElement("div")).className="pagination-drop-down",i.appendChild(n);var o=document.createElement("span");o.className="drop-down-box",n.appendChild(o),this.DropDownBox=o;var c=document.createElement("span");c.className="content",c.innerHTML=this.PerPage+" / Page",o.appendChild(c),this.DropDownBoxInner=c,(c=document.createElement("span")).className="icon",o.appendChild(c),l=document.createElement("i"),c.appendChild(l),(t=document.createElement("ul")).className="drop-down-list",t.style.cssText="display:none;",n.appendChild(t),this.DropDownList=t;for(var r=0;r<this.PerPageList.length;r++){var p=document.createElement("li");p.className="drop-down-item",p.setAttribute("data-value",this.PerPageList[r]),p.innerHTML=this.PerPageList[r]+" / Page",t.appendChild(p)}e.style.cssText="display:block;";var d=this;Pagination.prototype.turnPage=function(e,a){d.MaxPage=a||d.MaxPage,a=d.MaxPage,e=Number(e),isNaN(e)?e=d.CurPage:(e<1&&(e=1),a<e&&(e=a),d.CurPage=e),d.TurnPageEvent&&d.TurnPageEvent()},Pagination.prototype.setMaxPage=function(e){this.PageSelect.innerHTML="",this.MaxPage=e,(n=document.createElement("li")).className="pagination-select-li",this.PageSelect.appendChild(n),(t=document.createElement("a")).className="pagination-select-btn pagination-select-btn-prev",n.appendChild(t);for(var a=1;a<=e;a++){var t;if(1==a||a==e||Math.abs(this.CurPage-a)<=2)(n=document.createElement("li")).className="pagination-select-li",this.PageSelect.appendChild(n),(t=document.createElement("a")).className="pagination-select-item",t.innerHTML=a,n.appendChild(t),a==this.CurPage&&(t.className="pagination-select-item choosed");else if(3==Math.abs(a-this.CurPage)&&1!=a&&a!=e){var n;(n=document.createElement("li")).className="pagination-select-li",n.innerHTML="...",this.PageSelect.appendChild(n)}}(n=document.createElement("li")).className="pagination-select-li",this.PageSelect.appendChild(n),(t=document.createElement("a")).className="pagination-select-btn pagination-select-btn-next",n.appendChild(t)},EventUtil.add(this.PageSelect,"click",function(e){var a=e||window.event,t=a.srcElement||a.target;if("A"==t.nodeName)if("pagination-select-item"==t.className)d.turnPage(Number(t.innerHTML));else if(0<=t.className.indexOf("pagination-select-btn")){var n=d.CurPage;0<=t.className.indexOf("pagination-select-btn-next")?n=Number(d.CurPage)+1:0<=t.className.indexOf("pagination-select-btn-prev")&&(n=Number(d.CurPage)-1),d.turnPage(n)}}),EventUtil.add(this.PageInfo,"click",function(e){var a=e||window.event,t=a.srcElement||a.target,n=!1;"SPAN"==t.nodeName?"drop-down-box"!=t.parentNode.className&&"drop-down-box"!=t.className||(n=!0):"I"==t.nodeName&&"drop-down-box"==t.parentNode.parentNode.className&&(n=!0),n&&(d.DropDownList.style.cssText="display:block",e.stopPropagation?e.stopPropagation():e.cancelBubble=!0),"LI"==t.nodeName&&"drop-down-item"==t.className&&(d.DropDownBoxInner.innerHTML=t.innerHTML,d.PerPage=t.getAttribute("data-value"),d.turnPage(1))}),EventUtil.add(document,"click",function(e){d.DropDownList.style.cssText="display:none"}),EventUtil.add(this.PageJumpInput,"blur",function(e){isNaN(d.PageJumpInput.value)||d.turnPage(Number(d.PageJumpInput.value))})}


//tbl
function TableTitleItem(t,e,i,a){if(this.Id=i.id,this.Name=i.name||"",this.No=e||0,this.Action=i.action||null,this.Link=i.link||null,this.Width=i.width||30,this.hasSearch=i.search||!1,this.Tags=i.tags||[],0<this.Width&&this.Width<15&&(this.Width=15),this.Sortable=i.sortable||!1,this.Filterable=i.filterable||!1,this.WrapperWidth=this.Width,this.Sortable&&(this.WrapperWidth+=28),this.Filterable&&(this.WrapperWidth+=28),this.FilterList=[],i.filterlist)for(var l=0;l<i.filterlist.length;l++)i.filterlist[l].name?this.FilterList.push(i.filterlist[l]):this.FilterList.push({name:i.filterlist[l],selected:!0});this.SortMode="",this.Parent=t;var s=document.createElement("th");s.className="data-table-head-item",s.setAttribute("data-id",this.Id),this.Html=s,0<this.Width&&StyleUtil.set(s,"width",this.WrapperWidth+"px"),a.appendChild(s);var r=document.createElement("span");r.className="data-table-head-item-span",r.innerHTML=this.Name,0<this.Width&&StyleUtil.set(r,"width",this.Width+"px"),s.appendChild(r),this.Sortable&&((r=document.createElement("span")).className="data-table-head-item-span data-table-head-item-sort",s.appendChild(r),(l=document.createElement("i")).className="data-table-head-item-sort-asc",r.appendChild(l),this.SortBtnAsc=l,(l=document.createElement("i")).className="data-table-head-item-sort-desc",r.appendChild(l),this.SortBtnDesc=l);if(this.Filterable){(r=document.createElement("span")).className="data-table-head-item-span data-table-head-item-filter",s.appendChild(r);l=document.createElement("i");r.appendChild(l),this.FilterBtn=l}TableTitleItem.prototype.setWidth=function(t){var e=this.Width-t;this.Width=t,this.WrapperWidth=this.WrapperWidth-e,StyleUtil.set(this.Html,"width",+this.WrapperWidth+"px");var i=this.Html.children[0];StyleUtil.set(i,"width",+this.Width+"px"),this.No<this.Parent.FixColNo&&(this.Parent.FixedWidth-=e);var a=0,l=this.Parent.TitleList;this.Parent.hasNo&&(a=this.Parent.TitleNo.WrapperWidth+20);for(var s=0;s<l.length;s++)a+=l[s].WrapperWidth+20;a>this.Parent.Wrapper.offsetWidth?StyleUtil.set(this.Parent.FixedBody,"height",this.Parent.Height-17+"px"):StyleUtil.set(this.Parent.FixedBody,"height",this.Parent.Height+"px")},TableTitleItem.prototype.setSort=function(t){if(t=t||"",this.Sortable)if("asc"==t||"desc"==t)switch(this.SortMode=t){case"asc":this.SortBtnAsc.className="data-table-head-item-sort-asc_on",this.SortBtnDesc.className="data-table-head-item-sort-desc";break;case"desc":this.SortBtnDesc.className="data-table-head-item-sort-desc_on",this.SortBtnAsc.className="data-table-head-item-sort-asc"}else this.SortMode="",this.SortBtnAsc.className="data-table-head-item-sort-asc",this.SortBtnDesc.className="data-table-head-item-sort-desc"},TableTitleItem.prototype.resetFilterList=function(){if(this.Filterable){for(var t=0;t<this.FilterList.length;t++)this.FilterList[t].selected=!0;this.FilterBtn.className=""}},TableTitleItem.prototype.setFilterList=function(t){if(this.Filterable&&(t=t||null))if(t.all){this.FilterList.length=0;for(var e=t.all,i=0;i<e.length;i++)this.FilterList.push({name:e[i],selected:!0})}else if(t.add)for(e=t.add,i=0;i<e.length;i++)this.FilterList.push({name:e[i],selected:!0})},TableTitleItem.prototype.isSelectAll=function(){for(var t=0,e=0,i=0;i<this.FilterList.length;i++)this.FilterList[i].selected?t++:e++;return t==this.FilterList.length?1:e==this.FilterList.length?0:.5}}function DataTable(t,e){this.ParentHtml=t,this.FixColNo=e.FixCol||0,this.FixedWidth=0,this.Height=e.Height||200,this.TitleList=[],this.MenuMaxNum=e.MaxMenuNum||15,this.ColDraggable=e.ColDraggable||!1,this.hasNo=e.hasNo||!1,this.LoadEvent=e.loadEvent||null;var i=document.createElement("div");if(i.className="data-table",StyleUtil.set(i,"display","none"),t.appendChild(i),this.Wrapper=i,0<this.FixColNo||this.hasNo){(i=document.createElement("div")).className="data-table-fix",this.Wrapper.appendChild(i),this.FixedPart=i,(i=document.createElement("div")).className="data-table-head",this.FixedPart.appendChild(i),this.FixedHead=i;var a=document.createElement("table");i.appendChild(a);var l=document.createElement("tbody");a.appendChild(l);var s=document.createElement("tr");if(l.appendChild(s),this.hasNo){var r=new TableTitleItem(this,-1,{id:"No",name:"#",width:15},s);this.TitleNo=r,this.FixedWidth+=r.WrapperWidth+20}for(var d=0;d<this.FixColNo;d++){r=new TableTitleItem(this,d,e.Title[d],s);this.TitleList.push(r),this.FixedWidth+=r.WrapperWidth+20}(i=document.createElement("div")).className="data-table-body",StyleUtil.set(i,"height",this.Height+"px"),this.FixedPart.appendChild(i),this.FixedBody=i;a=document.createElement("table");i.appendChild(a),this.FixedTable=a,StyleUtil.set(a,"width",this.FixedWidth+"px")}(i=document.createElement("div")).className="data-table-scroll",this.Wrapper.appendChild(i),this.ScrollPart=i,(i=document.createElement("div")).className="data-table-head",this.ScrollPart.appendChild(i),this.ScrollHead=i;a=document.createElement("table");i.appendChild(a);l=document.createElement("tbody");if(a.appendChild(l),(s=document.createElement("tr")).className="data-table-head-tr",l.appendChild(s),0<this.FixedWidth){var o=document.createElement("th");StyleUtil.set(o,"width",this.FixedWidth+"px"),s.appendChild(o)}for(d=this.FixColNo;d<e.Title.length;d++){r=new TableTitleItem(this,d,e.Title[d],s);this.TitleList.push(r)}o=document.createElement("th"),StyleUtil.set(o,"width","17px"),s.appendChild(o),o=document.createElement("th"),s.appendChild(o),(i=document.createElement("div")).className="data-table-body",StyleUtil.set(i,"height",this.Height+"px"),this.ScrollPart.appendChild(i),this.ScrollBody=i;a=document.createElement("table");i.appendChild(a),this.ScrollTable=a,StyleUtil.set(this.Wrapper,"display","block"),this.DefaultNoData=document.createElement("div"),this.DefaultNoData.style.cssText="line-height:60px;text-align:center;display:none;font-size:14px;color:#ccc;",this.DefaultNoData.innerHTML="No data",i.appendChild(this.DefaultNoData);var n=0;for(d=0;d<this.TitleList.length;d++)n+=this.TitleList[d].WrapperWidth+20;n>this.Wrapper.offsetWidth&&StyleUtil.set(this.FixedBody,"height",this.Height-17+"px"),this.LoadingAnimate=new LoadingCircle(i),(i=document.createElement("div")).className="data-filter",StyleUtil.set(i,"display","none"),this.ParentHtml.appendChild(i),this.FilterMenu=i,(i=document.createElement("div")).className="data-filter-search",this.FilterMenu.appendChild(i),(this.FilterSearch=i).innerHTML="<i></i>";var h=document.createElement("input");h.setAttribute("type","text"),i.appendChild(h),this.FilterSearchInput=h;var c=document.createElement("a");c.className="data-filter-btn",i.appendChild(c),c.innerHTML='<i class="data-filter-btn-ok"></i>',(c=document.createElement("a")).className="data-filter-btn",i.appendChild(c),c.innerHTML='<i class="data-filter-btn-del"></i>',(i=document.createElement("div")).className="data-filter-select-all all",this.FilterMenu.appendChild(i),i.innerHTML="<i></i><span>All</span>",this.FilterAllBar=i,(i=document.createElement("div")).className="data-filter-list",this.FilterMenu.appendChild(i);var p=document.createElement("ul");p.className="data-filter-list-ul",i.appendChild(p),this.FilterMenuUl=p;var f=this;DataTable.prototype.scrollTblBody=function(){f.ScrollHead.scrollLeft=f.ScrollBody.scrollLeft,f.FixedBody&&(f.FixedBody.scrollTop=f.ScrollBody.scrollTop),StyleUtil.set(f.FilterMenu,"display","none")},EventUtil.add(this.ScrollBody,"scroll",EventUtil.throttle(f.scrollTblBody,10,10)),EventUtil.add(this.Wrapper,"click",function(t){var e=t||window.event,i=e.srcElement||e.target,a=f.TitleList;if("I"==i.nodeName){var l="";if(i.parentNode&&i.parentNode.parentNode&&(l=i.parentNode.parentNode.getAttribute("data-id")),0==l.length)return;if(0<=i.className.indexOf("data-table-head-item-sort")){var s="";switch(i.className){case"data-table-head-item-sort-asc":s="asc";break;case"data-table-head-item-sort-desc":s="desc"}for(var r=0;r<a.length;r++)if(a[r].Id==l){a[r].setSort(s);break}f.LoadEvent&&f.LoadEvent()}if(0<=i.parentNode.className.indexOf("data-table-head-item-filter"))for(r=0;r<a.length;r++){if((h=a[r]).Id==l&&0<h.FilterList.length){f.FilterColNo=r,f.FilterSearchInput.value="",f.showFilterItem(0),h.hasSearch?StyleUtil.set(f.FilterSearch,"display","block"):StyleUtil.set(f.FilterSearch,"display","none");var d=h.isSelectAll();1==d?f.FilterAllBar.className="data-filter-select-all all":0==d?f.FilterAllBar.className="data-filter-select-all no":.5==d&&(f.FilterAllBar.className="data-filter-select-all part"),r>=f.FixColNo?f.FilterMenu.style.cssText="display:block;left:"+(h.Html.offsetLeft+f.Wrapper.offsetLeft-f.ScrollBody.scrollLeft)+"px;top:"+(f.Wrapper.offsetTop+48)+"px":f.FilterMenu.style.cssText="display:block;left:"+(h.Html.offsetLeft+f.Wrapper.offsetLeft)+"px;top:"+(f.Wrapper.offsetTop+48)+"px",t.stopPropagation?t.stopPropagation():t.cancelBubble=!0;break}}}else if("TD"==i.nodeName||"TD"==i.parentNode.nodeName||"TD"==i.parentNode.parentNode.nodeName){var o=i;"TD"==i.parentNode.nodeName?o=i.parentNode:"TD"==i.parentNode.parentNode.nodeName&&(o=i.parentNode.parentNode);var n=o.getAttribute("data-col"),h=f.TitleList[n],c=o.parentNode.getAttribute("data-id");h.Action&&h.Action(c)}}),DataTable.prototype.hoverRow=function(t){var e=t||window.event;try{var i=e.srcElement||e.target,a=0;if("TD"!=i.nodeName)return;if(i.parentNode){a=i.parentNode.getAttribute("data-row");var l=i.getAttribute("data-col");if(l)f.TitleList[l].Action&&StyleUtil.set(i,"cursor","pointer")}this.FixedRows.length;this.ActiveNo&&-1<this.ActiveNo&&this.ActiveNo<this.FixedRows.length&&(this.FixedRows[this.ActiveNo]&&(this.FixedRows[this.ActiveNo].className=""),this.ScrollRows[this.ActiveNo].className=""),this.FixedRows[a]&&(this.FixedRows[a].className="data-table-row_on"),this.ScrollRows[a].className="data-table-row_on",this.ActiveNo=a,StyleUtil.del(f.Wrapper,"cursor"),f.MoveHeadCol=-1}catch(t){console.log("Fail to hover row"),console.log(t)}},EventUtil.add(this.ScrollTable,"mousemove",EventUtil.throttle(function(t){f.hoverRow(t)},50,50)),EventUtil.add(this.FixedTable,"mousemove",EventUtil.throttle(function(t){f.hoverRow(t)},50,50)),this.ColDraggable&&(DataTable.prototype.hoverHead=function(t,e){var i=MouseUtil.getEventPosition(t),a=f.TitleList,l=!1;if(e)var s=f.FixColNo,r=0;else s=a.length,r=f.FixColNo;if(!(-1<f.MoveHeadCol&&f.onDrag)){for(var d=r;d<s;d++){var o=a[d].Html.offsetLeft+a[d].Html.offsetWidth;if(Math.abs(o-i.x)<3){StyleUtil.set(f.Wrapper,"cursor","col-resize"),l=!0,f.MoveHeadCol=d;break}}f.onDrag||l||(StyleUtil.del(f.Wrapper,"cursor"),f.MoveHeadCol=-1)}},EventUtil.add(this.FixedHead,"mousemove",EventUtil.throttle(function(t){f.hoverHead(t,!0)},100,100)),EventUtil.add(this.ScrollHead,"mousemove",EventUtil.throttle(function(t){f.hoverHead(t)},100,100)),EventUtil.add(this.Wrapper,"mousedown",function(t){f.onDrag=!0,-1<f.MoveHeadCol&&(f.DragStart=MouseUtil.getEventPosition(t).x)}),EventUtil.add(this.Wrapper,"mouseup",function(t){StyleUtil.del(f.Wrapper,"cursor"),f.onDrag=!1;var e=t||window.event,i=e.srcElement||e.target,a=f.MoveHeadCol;if(-1<a){f.DragEnd=MouseUtil.getEventPosition(t).x,"I"==i.nodeName?f.DragEnd+=i.parentNode.offsetLeft+i.parentNode.parentNode.offsetLeft:"SPAN"==i.nodeName&&(f.DragEnd+=i.parentNode.offsetLeft);var l=f.DragEnd-f.DragStart,s=f.TitleList[a];s.WrapperWidth+l<50&&(l=50-s.WrapperWidth),s.setWidth(s.Width+l);var r=f.FixColNo;if(a<r){for(var d=f.FixedBody.children[0],o=d.children,n=0;n<o.length;n++){var h=o[n].children[a];if(f.hasNo)h=o[n].children[a+1];StyleUtil.set(h,"width",s.WrapperWidth+"px")}var c=StyleUtil.get(d,"width");c=c.replace("px",""),c=Number(c),StyleUtil.set(d,"width",c+l+"px"),d=f.FixedHead.children[0],StyleUtil.set(d,"width",c+l+"px");var p=f.ScrollHead.children[0].children[0].children[0];c=(c=StyleUtil.get(p,"width")).replace("px",""),c=Number(c),StyleUtil.set(p,"width",c+l+"px");for(o=f.ScrollBody.children[0].children,n=0;n<o.length;n++){var m=n;this.hasNo&&(m=n+1),StyleUtil.set(o[n].children[m],"width",c+l+"px")}}else for(o=f.ScrollBody.children[0].children,n=0;n<o.length;n++)StyleUtil.set(o[n].children[a-r+1],"width",s.WrapperWidth+"px");f.MoveHeadCol=-1}}),EventUtil.add(this.Wrapper,"selectstart",function(t){f.onDrag&&-1<f.MoveHeadCol&&(t.returnValue=!1)})),DataTable.prototype.showFilterItem=function(t){var e=f.FilterMenuUl,i=f.MenuMaxNum,a=f.TitleList[f.FilterColNo],l=0,s=t+i-1,r=f.FilterSearchInput.value.toLowerCase();e.innerHTML="",0<t&&((o=document.createElement("li")).className="data-filter-more up",o.innerHTML="<span>Previous ... "+(t-i+1)+"~"+t+"</span>",e.appendChild(o));for(var d=t;l<=i;d++){if(d>=a.FilterList.length){s=a.FilterList.length-1;break}if(!(0<r.length&&-1==a.FilterList[d].name.toLowerCase().indexOf(r))){var o=document.createElement("li");if(a.FilterList[d].selected?o.className="data-filter-item choosed":o.className="data-filter-item",o.setAttribute("data-num",d),o.innerHTML="<i></i><span>"+a.FilterList[d].name+"</span>",e.appendChild(o),++l==i){s=d;break}}}a.FilterList.length>s+1&&((o=document.createElement("li")).className="data-filter-more down",o.innerHTML="<span>Next ... "+(s+2)+"~"+(s+i+1)+"</span>",e.appendChild(o))},EventUtil.add(this.FilterMenuUl,"click",function(t){var e=t||window.event,i=e.srcElement||e.target,a=0,l=i;if("I"==i.nodeName||"SPAN"==i.nodeName)i.parentNode&&(l=i.parentNode);else{if("LI"!=i.nodeName)return;l=i}if(0<=l.className.indexOf("data-filter-item")){a=l.getAttribute("data-num");var s=!1,r=f.TitleList[f.FilterColNo];0<=l.className.indexOf("choosed")?l.className="data-filter-item":(l.className="data-filter-item choosed",s=!0),r.FilterList[a].selected=s;var d=r.isSelectAll();1==d?f.FilterAllBar.className="data-filter-select-all all":0==d?f.FilterAllBar.className="data-filter-select-all no":.5==d&&(f.FilterAllBar.className="data-filter-select-all part")}else if(0<=l.className.indexOf("data-filter-more")){var o=f.FilterMenuUl,n=0,h=f.MenuMaxNum;if(n=0<=o.childNodes[0].className.indexOf("data-filter-item")?o.childNodes[0].getAttribute("data-num"):o.childNodes[1].getAttribute("data-num"),n=Number(n),0<=l.className.indexOf("down"))var c=n+h;else if(0<=l.className.indexOf("up"))c=n-h;f.showFilterItem(c)}t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},!1),EventUtil.add(this.FilterAllBar,"click",function(t){var e=t||window.event,i=(e.srcElement||e.target,f.TitleList[f.FilterColNo]),a=f.FilterAllBar,l=f.FilterMenuUl.children;if("data-filter-select-all all"==a.className){a.className="data-filter-select-all no";for(var s=0;s<i.FilterList.length;s++)i.FilterList[s].selected&&(i.FilterList[s].selected=!1);for(s=0;s<l.length;s++)"data-filter-item choosed"==l[s].className&&(l[s].className="data-filter-item")}else{a.className="data-filter-select-all all";for(s=0;s<i.FilterList.length;s++)i.FilterList[s].selected||(i.FilterList[s].selected=!0);for(s=0;s<l.length;s++)"data-filter-item"==l[s].className&&(l[s].className="data-filter-item choosed")}t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}),EventUtil.add(this.FilterSearch,"click",function(t){var e=t||window.event;"data-filter-btn-del"==(e.srcElement||e.target).className&&(f.FilterSearchInput.value=""),f.showFilterItem(0),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},!1),EventUtil.add(document,"click",function(t){if("block"==StyleUtil.get(f.FilterMenu,"display")){StyleUtil.set(f.FilterMenu,"display","none");var e=f.TitleList[f.FilterColNo],i=e.isSelectAll();e.FilterBtn.className=1==i?"":"data-table-head-item-filter_on",f.LoadEvent&&f.LoadEvent()}}),DataTable.prototype.wait=function(){this.FixedRows=[],this.ScrollRows=[],StyleUtil.set(this.ScrollTable,"display","none"),StyleUtil.set(this.FixedTable,"display","none"),StyleUtil.set(this.FilterMenu,"display","none"),this.LoadingAnimate.start(),this.LoadingAnimate.show();for(var t=this.ScrollTable;t.hasChildNodes();)t.removeChild(t.firstChild);for(t=this.FixedTable;t.hasChildNodes();)t.removeChild(t.firstChild);this.ActiveNo=-1},DataTable.prototype.createTd=function(t,e,i,a){var l=document.createElement("td");if(l.setAttribute("data-col",t.No),e.length>i){var s='<span class="data-table-body-td-content" style="'+t.WrapperWidth+'px;">'+e[i]+"</span>";if(0<t.Tags.length)for(var r=0;r<t.Tags.length;r++)if(t.Tags[r].name==e[i]){s='<span class="data-table-body-td-tag" style="background-color:'+t.Tags[r].color+';">'+s+"</span>";break}t.Link?l.innerHTML='<a href="'+t.Link(a)+'" target="_blank">'+s+"</a>":t.Action?l.innerHTML="<a>"+s+"</a>":l.innerHTML=s}return l.className="data-table-body-td",StyleUtil.set(l,"width",t.WrapperWidth+"px"),l},DataTable.prototype.loadData=function(t){if(this.wait(),0==t.length?StyleUtil.set(this.DefaultNoData,"display","block"):StyleUtil.set(this.DefaultNoData,"display","none"),this.FixedTable){var e=document.createElement("tbody");this.FixedTable.appendChild(e)}var i=document.createElement("tbody");this.ScrollTable.appendChild(i);for(var a=0;a<t.length;a++){var l=t[a];if(this.FixedTable){var s=document.createElement("tr");if(s.setAttribute("data-row",a),s.setAttribute("data-id",l.id),this.hasNo)(d=document.createElement("td")).className="data-table-body-td",d.innerHTML=a+1,StyleUtil.set(d,"width",this.TitleNo.WrapperWidth+"px"),s.appendChild(d);for(var r=0;r<this.FixColNo;r++){var d=this.createTd(this.TitleList[r],l.cols,r,l.id);s.appendChild(d)}e.appendChild(s),this.FixedRows.push(s)}(s=document.createElement("tr")).setAttribute("data-row",a),s.setAttribute("data-id",l.id);d=document.createElement("td");StyleUtil.set(d,"width",this.FixedWidth+"px"),s.appendChild(d);for(r=this.FixColNo;r<this.TitleList.length;r++){d=this.createTd(this.TitleList[r],l.cols,r,l.id);s.appendChild(d)}(d=document.createElement("td")).className="data-table-body-td",s.appendChild(d),i.appendChild(s),this.ScrollRows.push(s)}this.LoadingAnimate.stop(),this.LoadingAnimate.hide(),StyleUtil.del(this.ScrollTable,"display"),StyleUtil.del(this.FixedTable,"display")},DataTable.prototype.setFilterList=function(t){for(var e=0;e<t.length;e++)for(var i=0;i<this.TitleList.length;i++){var a=this.TitleList[i];if(a.Id==t[e].id){a.setFilterList(t[e]);break}}},DataTable.prototype.getSortFields=function(){for(var t=[],e=this.TitleList,i=0;i<e.length;i++)0<e[i].SortMode.length&&t.push({name:e[i].Id,mode:e[i].SortMode});return t},DataTable.prototype.getFilterFields=function(){for(var t=[],e=this.TitleList,i=[],a=[],l="select",s=0;s<e.length;s++)if(1!=e[s].isSelectAll()){i=[],a=[],l="select";for(var r=0;r<e[s].FilterList.length;r++)e[s].FilterList[r].selected?i.push(e[s].FilterList[r].name):a.push(e[s].FilterList[r].name);a.length<i.length&&(l="unselect",i=a),t.push({id:e[s].Id,mode:l,values:i})}return t},DataTable.prototype.resetFilter=function(){for(var t=this.TitleList,e=0;e<t.length;e++){var i=t[e];i.setSort(),i.resetFilterList()}},DataTable.prototype.getFilterList=function(){for(var t=[],e=this.TitleList,i=[],a=0;a<e.length;a++){i=[];for(var l=0;l<e[a].FilterList.length;l++)i.push(e[a].FilterList[l].name);0<i.length&&t.push({id:e[a].Id,values:i})}return t}}
